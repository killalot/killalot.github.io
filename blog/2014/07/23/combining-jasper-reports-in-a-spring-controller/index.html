
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Combining Jasper Reports in a Spring Controller - Ticnfae</title>
  <meta name="author" content="Peter Nicholson">

  
  <meta name="description" content="I have come across a scenario where I was required to combine multiple instances of the same Jasper report into a single pdf file. So here is a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="www.ticnfae.co.uk/blog/2014/07/23/combining-jasper-reports-in-a-spring-controller">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="" rel="alternate" title="Ticnfae" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Shadows+Into+Light|Droid+Serif|Open+Sans' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26245170-3']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Ticnfae</a></h1>
  
    <h2>Things I could not find anywhere else</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <!-- <li><a href="" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li> -->
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.ticnfae.co.uk" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Combining Jasper Reports in a Spring Controller</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-23T20:37:51+01:00" pubdate data-updated="true">Jul 23<sup>rd</sup>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="www.ticnfae.co.uk">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>I have come across a scenario where I was required to combine multiple instances of the same Jasper report into a single pdf file. So here is a Spring controller that demonstrates this. I have also included a method for printing a single report as well so you can see the difference.</p>




<figure class='code'><figcaption><span> (CombineReportsController.java)</span> <a href='/downloads/code/combining-jasper-reports-in-a-spring-controller/CombineReportsController.java'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Controller</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CombineReportsController</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Autowired</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">EntityDao</span> <span class="n">entityDao</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;/print_selected&quot;</span><span class="o">,</span><span class="n">method</span><span class="o">=</span><span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">printSelected</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">&quot;ids[]&quot;</span><span class="o">)</span> <span class="n">Long</span><span class="o">[]</span> <span class="n">ids</span><span class="o">,</span><span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JRException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">{</span>
</span><span class='line'>        <span class="c1">// get the jrxml file from the class path</span>
</span><span class='line'>        <span class="n">URL</span> <span class="n">reportPath</span>  <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">&quot;/jasper_reports/print_multiple.jrxml&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">List</span><span class="o">&lt;</span><span class="n">JasperPrint</span><span class="o">&gt;</span> <span class="n">jpList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>        <span class="c1">// gather any entities that need to be passed to jasper</span>
</span><span class='line'>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entities</span> <span class="o">=</span> <span class="n">entityDao</span><span class="o">.</span><span class="na">printMultiple</span><span class="o">(</span><span class="n">ids</span><span class="o">);</span>
</span><span class='line'>        <span class="k">for</span><span class="o">(</span><span class="n">Entity</span> <span class="n">entity</span> <span class="o">:</span> <span class="n">entities</span><span class="o">){</span>
</span><span class='line'>            <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span><span class='line'>            <span class="c1">// add entity and any other parameters</span>
</span><span class='line'>            <span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;entity&quot;</span><span class="o">,</span> <span class="n">entity</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// create JasperReport for each entity instance</span>
</span><span class='line'>            <span class="n">JasperReport</span> <span class="n">jreport</span> <span class="o">=</span> <span class="n">JasperCompileManager</span><span class="o">.</span><span class="na">compileReport</span><span class="o">(</span><span class="n">reportPath</span><span class="o">.</span><span class="na">getPath</span><span class="o">());</span>
</span><span class='line'>            <span class="n">JasperPrint</span> <span class="n">jprint</span> <span class="o">=</span> <span class="n">JasperFillManager</span><span class="o">.</span><span class="na">fillReport</span><span class="o">(</span><span class="n">jreport</span><span class="o">,</span> <span class="n">params</span><span class="o">,</span> <span class="k">new</span> <span class="nf">JRBeanCollectionDataSource</span> <span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getItems</span><span class="o">()));</span>
</span><span class='line'>
</span><span class='line'>            <span class="c1">// add report to list</span>
</span><span class='line'>            <span class="n">jpList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">jprint</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="c1">// export reports using a single exporter and pass output stream of response object</span>
</span><span class='line'>        <span class="n">JRPdfExporter</span> <span class="n">exporter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JRPdfExporter</span><span class="o">();</span>
</span><span class='line'>        <span class="n">exporter</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="n">JRPdfExporterParameter</span><span class="o">.</span><span class="na">JASPER_PRINT_LIST</span><span class="o">,</span> <span class="n">jpList</span><span class="o">);</span>
</span><span class='line'>        <span class="n">exporter</span><span class="o">.</span><span class="na">setParameter</span><span class="o">(</span><span class="n">JRPdfExporterParameter</span><span class="o">.</span><span class="na">OUTPUT_STREAM</span><span class="o">,</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
</span><span class='line'>        <span class="n">exporter</span><span class="o">.</span><span class="na">exportReport</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;/{id}/print&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">ModelAndView</span> <span class="nf">printSingle</span><span class="o">(</span><span class="n">ModelMap</span> <span class="n">modelMap</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="n">Long</span> <span class="n">id</span><span class="o">){</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Entity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">entityDao</span><span class="o">.</span><span class="na">printSingle</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span><span class='line'>        <span class="n">JRDataSource</span> <span class="n">datasource</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JRBeanCollectionDataSource</span> <span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">getItems</span><span class="o">());</span>
</span><span class='line'>        <span class="n">modelMap</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;datasource&quot;</span><span class="o">,</span> <span class="n">datasource</span><span class="o">);</span>
</span><span class='line'>        <span class="n">modelMap</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;entity&quot;</span><span class="o">,</span> <span class="n">entity</span><span class="o">);</span>
</span><span class='line'>        <span class="n">modelMap</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&quot;format&quot;</span><span class="o">,</span> <span class="s">&quot;pdf&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// &quot;entityPrintSingle&quot; is the bean id, declared inside the jasper-views.xml</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">ModelAndView</span><span class="o">(</span><span class="s">&quot;entityPrintSingle&quot;</span><span class="o">,</span> <span class="n">modelMap</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<p>The main difference between the 2 methods is that in the printSingle() method, Spring exports the Jasper report itself using the returned ModelAndView object. However the printSelected() method is performing the export manually in order to provide the list of Jasper reports to the exporter.</p>




<h2>References</h2>


<ul>
    <li><a target="_blank" href="http://stackoverflow.com/questions/8564163/how-to-collate-multiple-jrxml-jasper-reports-into-a-one-single-pdf-output-file">Multiple jrxml reports into one file</a></li>
    <li><a target="_blank" href="http://krams915.blogspot.co.uk/2010/12/spring-3-mvc-dynamic-jasper-integration.html">Dynamic jasper integration</a></li>
    <li><a target="_blank" href="http://jasperreports.sourceforge.net/api/net/sf/jasperreports/engine/export/JRPdfExporter.html#exportReport%28%29">JRPdfExporter</a></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Peter Nicholson</span></span>

      








  


<time datetime="2014-07-23T20:37:51+01:00" pubdate data-updated="true">Jul 23<sup>rd</sup>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/jasper/'>jasper</a>, <a class='category' href='/blog/categories/spring/'>spring,</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="www.ticnfae.co.uk/blog/2014/07/23/combining-jasper-reports-in-a-spring-controller" data-via="" data-counturl="www.ticnfae.co.uk/blog/2014/07/23/combining-jasper-reports-in-a-spring-controller" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/07/21/accessing-java-properties-outside-spring-beans" title="Previous Post: Accessing java properties outside spring beans">&laquo; Accessing java properties outside spring beans</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/23/combining-jasper-reports-in-a-spring-controller">Combining Jasper Reports in a Spring Controller</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/21/accessing-java-properties-outside-spring-beans">Accessing Java Properties Outside Spring Beans</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/16/hibernate-multi-tenancy-with-spring">Hibernate Multi Tenancy With Spring</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Peter Nicholson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - 
  <span class="credit">Hosted by <a href="https://pages.github.com/">GitHub Pages</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ticnfae';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'www.ticnfae.co.uk/blog/2014/07/23/combining-jasper-reports-in-a-spring-controller';
        var disqus_url = 'www.ticnfae.co.uk/blog/2014/07/23/combining-jasper-reports-in-a-spring-controller';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
